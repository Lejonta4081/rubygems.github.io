---
title: CVE-2013-4287 Algorithmic complexity vulnerability in RubyGems 2.1.4 and older
layout: post
author: Eric Hodel
author_email: drbrain@segment7.net
---

The patch for CVE-2013-4287 was insufficiently verified so the combined
regular expression for verifying gem version remains vulnerable following
CVE-2013-4287.

RubyGems validates versions with a regular expression that is vulnerable to
denial of service due to backtracking.  For specially crafted RubyGems
versions attackers can cause denial of service through CPU consumption.

RubyGems versions 2.1.4 and older are vulnerable.

RubyGems versions [2.1.5][2.1.5], [2.0.10][2.0.10], [1.8.27][1.8.27] and
[1.8.23.2][1.8.23.2] contain fixes.

Ruby versions 1.9.0 through 2.0.0p247 are vulnerable as they contain embedded
versions of RubyGems.

It does not appear to be possible to exploit this vulnerability by installing a
gem for RubyGems 1.8.x or newer.  Vulnerable uses of RubyGems API include
packaging a gem (through `gem build`, Gem::Package or Gem::PackageTask),
sending user input to Gem::Version.new, Gem::Version.correct? or use of the
Gem::Version::VERSION_PATTERN or Gem::Version::ANCHORED_VERSION_PATTERN
constants.

Notably, users of bundler that install gems from git are vulnerable if a
malicious author changes the gemspec to an invalid version.

The vulnerability can be fixed through one of the following patches to remove
infinite repetition in Gem::Version::ANCHORED_VERSION_PATTERN in
lib/rubygems/version.rb:

Patch for [RubyGems 2.1.x](https://github.com/rubygems/rubygems/commit/dca0500bb24c7cba5551468a1ed28388876aded2)

Patch for [RubyGems 2.0.x](https://github.com/rubygems/rubygems/commit/20325c134b5ca1928a15338eeb7ead1239dbf2b9)

Patch for [RubyGems 1.8.x](https://github.com/rubygems/rubygems/commit/f63bfbc5c7b5725def5fecd6518ce2aa49e12ecd)

Patch for [RubyGems 1.8.23.1](https://github.com/rubygems/rubygems/commit/56d1f8c17bc81f0eb354d5099021c498a0be9b51)

This vulnerability was discovered by Alexander Cherepanov <cherepan@mccme.ru>

[2.1.5]:    /2013/09/24/2.1.5-released.html
[2.0.10]:   /2013/09/24/2.0.10-released.html
[1.8.27]:   /2013/09/24/1.8.27-released.html
[1.8.23.2]: /2013/09/24/1.8.23.2-released.html

